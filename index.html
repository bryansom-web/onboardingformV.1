    <script>
      // ===== TRADUCCIONES =====
      const translations = {
        es: {
          "brand.title": "Onboarding form",
          "brand.subtitle": "Formulario de vinculación de comercios",
          "hero.title": "Tu onboarding, hecho simple y seguro.",
          "hero.subtitle":
            "Vinculación sin fricción. Cumplimiento sin complicaciones.",
          "hero.tagline":
            "AML-first · LATAM-ready · Diseñado para fintechs y equipos de compliance",

          "section.business.title": "Datos del comercio",
          "section.business.desc":
            "Información legal básica de la entidad que será vinculada.",
          "label.businessName": "Nombre legal del comercio",
          "label.tradeName": "Nombre comercial / marca",
          "label.country": "País de constitución",
          "help.country":
            "Si seleccionas “Otro”, por favor indícalo en el campo adicional.",
          "label.regNumber": "NIT / Registro mercantil / Tax ID",
          "label.address": "Dirección legal",
          "label.website": "Sitio web",
          "option.country.placeholder": "Selecciona un país",

          "section.activity.title": "Actividad económica y riesgo sectorial",
          "section.activity.desc":
            "Entendemos qué haces, a quién atiendes y en qué mercados operas.",
          "label.industry": "Actividad principal / sector",
          "option.industry.placeholder": "Selecciona sector",
          "label.customerType": "Tipo de clientes",
          "option.customerType.placeholder": "Selecciona una opción",
          "label.salesChannels": "Canales de venta principales",
          "label.customerCountries": "Países donde están tus clientes",
          "label.businessModel":
            "Describe brevemente tu modelo de negocio",

          "section.rep.title": "Representante legal",
          "section.rep.desc":
            "Persona autorizada para actuar en nombre del comercio.",
          "label.repName": "Nombre completo",
          "label.repRole": "Cargo",
          "label.repId": "Documento de identidad",
          "label.repNationality": "Nacionalidad",
          "label.repEmail": "Correo corporativo",
          "label.repPhone": "Teléfono",
          "label.repPep": "¿Es PEP (Persona Expuesta Políticamente)?",
          "option.pep.placeholder": "Selecciona una opción",
          "option.no": "No",
          "option.yes": "Sí",

          "section.ubos.title": "Beneficial Owners (UBOs)",
          "section.ubos.desc":
            "Propietarios reales con 25% o más de participación, o control efectivo equivalente.",
          "button.addUbo": "Agregar UBO",
          "help.ubos":
            "Puedes agregar uno o varios UBOs según tu estructura accionaria.",
          "ubo.title": "UBO",
          "label.uboName": "Nombre completo",
          "label.uboNationality": "Nacionalidad",
          "label.uboOwnership": "% de participación",
          "label.uboId": "Documento de identidad",
          "label.uboResidence": "País de residencia",
          "label.uboPep": "¿Es PEP?",

          "section.usage.title": "Volumen y uso esperado del servicio",
          "section.usage.desc":
            "Información usada para monitoreo transaccional y calibración de riesgo.",
          "label.monthlyVolume": "Volumen mensual estimado",
          "option.volume.placeholder": "Selecciona un rango",
          "label.currencies": "Monedas de operación principales",
          "label.inboundCountries":
            "Países desde donde recibirás fondos",
          "label.outboundCountries":
            "Países hacia donde enviarás fondos (si aplica)",
          "label.cashUsage":
            "¿Manejas efectivo como parte del modelo?",
          "option.cash.placeholder": "Selecciona una opción",

          "section.docs.title": "Documentos iniciales",
          "section.docs.desc":
            "Adjunta los documentos requeridos para validar la existencia legal del comercio y sus beneficiarios. Esta información es tratada bajo estándares AML/KYB y se mantiene de forma segura.",
          "label.docCert":
            "Certificado de constitución / Cámara de comercio",
          "label.docRep": "Documento del representante legal",
          "label.docUbos": "Documentos de identidad UBO(s)",
          "label.docStructure": "Estructura accionaria / organigrama",

          "section.declarations.title": "Declaraciones y consentimientos",
          "section.declarations.desc":
            "Estas declaraciones son requeridas para cumplir con estándares AML/KYC y normativa de protección de datos.",
          "dec.truth":
            "Declaro que la información suministrada es verdadera y completa.",
          "dec.data":
            "Autorizo el tratamiento de mis datos y los de la empresa conforme a la normativa aplicable de protección de datos y prevención de lavado de activos.",
          "dec.illicit":
            "Declaro que la empresa no utilizará este servicio para actividades ilícitas, incluyendo lavado de activos o financiación del terrorismo.",
          "dec.sanctions":
            "Confirmo que la empresa no opera ni tendrá operaciones relevantes con personas o jurisdicciones sancionadas (ej. OFAC/EU/ONU), salvo autorización expresa y documentada.",

          "button.submit": "Enviar registro",
          "footer.text":
            "Flujo AML/KYB para onboarding de comercios. En producción, este formulario puede conectarse a Airtable, Blob Storage y tu GPT de compliance.",
          "option.other": "Otro",

          statusRequired:
            "Por favor completa los campos obligatorios marcados con *.",
          statusSuccess:
            "Los datos se han validado y enviado correctamente."
        },

        en: {
          "brand.title": "Onboarding form",
          "brand.subtitle": "Merchant onboarding form",
          "hero.title": "Your onboarding, made simple and safe.",
          "hero.subtitle":
            "Frictionless onboarding. Compliance without complexity.",
          "hero.tagline":
            "AML-first · LATAM-ready · Built for fintechs and compliance teams",

          "section.business.title": "Merchant legal details",
          "section.business.desc":
            "Basic legal information of the entity to be onboarded.",
          "label.businessName": "Legal business name",
          "label.tradeName": "Trade name / brand",
          "label.country": "Country of incorporation",
          "help.country":
            'If you select "Other", please specify the country in the additional field.',
          "label.regNumber": "Registry / Tax ID",
          "label.address": "Registered address",
          "label.website": "Website",
          "option.country.placeholder": "Select a country",

          "section.activity.title": "Business activity & sectoral risk",
          "section.activity.desc":
            "We understand what you do, who you serve and in which markets you operate.",
          "label.industry": "Primary activity / sector",
          "option.industry.placeholder": "Select a sector",
          "label.customerType": "Customer type",
          "option.customerType.placeholder": "Select an option",
          "label.salesChannels": "Main sales channels",
          "label.customerCountries": "Countries where your customers are",
          "label.businessModel":
            "Briefly describe your business model",

          "section.rep.title": "Legal representative",
          "section.rep.desc":
            "Person authorized to act on behalf of the merchant.",
          "label.repName": "Full name",
          "label.repRole": "Role / position",
          "label.repId": "ID document",
          "label.repNationality": "Nationality",
          "label.repEmail": "Corporate email",
          "label.repPhone": "Phone",
          "label.repPep": "Is this person a PEP?",
          "option.pep.placeholder": "Select an option",
          "option.no": "No",
          "option.yes": "Yes",

          "section.ubos.title": "Beneficial Owners (UBOs)",
          "section.ubos.desc":
            "Real owners with 25%+ ownership or equivalent effective control.",
          "button.addUbo": "Add UBO",
          "help.ubos":
            "You can add one or several UBOs according to your shareholding structure.",
          "ubo.title": "UBO",
          "label.uboName": "Full name",
          "label.uboNationality": "Nationality",
          "label.uboOwnership": "Ownership %",
          "label.uboId": "ID document",
          "label.uboResidence": "Country of residence",
          "label.uboPep": "Is PEP?",

          "section.usage.title": "Expected usage & transaction volume",
          "section.usage.desc":
            "Information used for transaction monitoring and risk calibration.",
          "label.monthlyVolume": "Estimated monthly volume",
          "option.volume.placeholder": "Select a range",
          "label.currencies": "Main operating currencies",
          "label.inboundCountries":
            "Countries from which you will receive funds",
          "label.outboundCountries":
            "Countries to which you will send funds (if applicable)",
          "label.cashUsage":
            "Do you handle cash as part of your model?",
          "option.cash.placeholder": "Select an option",

          "section.docs.title": "Initial documents",
          "section.docs.desc":
            "Upload the required documents to validate the legal existence of the business and its beneficial owners. This information is handled following AML/KYB standards and stored securely.",
          "label.docCert":
            "Certificate of incorporation / Registry extract",
          "label.docRep": "Legal representative ID document",
          "label.docUbos": "UBO ID documents",
          "label.docStructure":
            "Shareholding structure / org chart",

          "section.declarations.title": "Declarations & consents",
          "section.declarations.desc":
            "These declarations are required to comply with AML/KYC standards and data protection regulation.",
          "dec.truth":
            "I declare that the information provided is true and complete.",
          "dec.data":
            "I authorize the processing of my data and the company’s data in accordance with applicable data protection and AML regulations.",
          "dec.illicit":
            "I declare that the company will not use this service for illicit activities, including money laundering or terrorist financing.",
          "dec.sanctions":
            "I confirm that the company does not operate and will not have relevant operations with sanctioned persons or jurisdictions (e.g. OFAC/EU/UN), unless expressly authorized and documented.",

          "button.submit": "Submit registration",
          "footer.text":
            "AML/KYB flow for merchant onboarding. In production, this form can be connected to Airtable, Blob Storage and your compliance GPT.",
          "option.other": "Other",

          statusRequired:
            "Please complete the required fields marked with *.",
          statusSuccess:
            "Data has been validated and sent successfully."
        }
      };

      let currentLang = "es";

      function applyTranslations(lang) {
        const dict = translations[lang] || translations.es;

        document.querySelectorAll("[data-i18n]").forEach((el) => {
          const key = el.getAttribute("data-i18n");
          if (dict[key]) {
            el.textContent = dict[key];
          }
        });

        const optCountry = document.querySelector(
          'option[data-i18n="option.country.placeholder"]'
        );
        if (optCountry && dict["option.country.placeholder"]) {
          optCountry.textContent = dict["option.country.placeholder"];
        }

        const optIndustry = document.querySelector(
          'option[data-i18n="option.industry.placeholder"]'
        );
        if (optIndustry && dict["option.industry.placeholder"]) {
          optIndustry.textContent = dict["option.industry.placeholder"];
        }

        const optCustomerType = document.querySelector(
          'option[data-i18n="option.customerType.placeholder"]'
        );
        if (optCustomerType && dict["option.customerType.placeholder"]) {
          optCustomerType.textContent =
            dict["option.customerType.placeholder"];
        }

        const optPep = document.querySelector(
          'option[data-i18n="option.pep.placeholder"]'
        );
        if (optPep && dict["option.pep.placeholder"]) {
          optPep.textContent = dict["option.pep.placeholder"];
        }

        const optVolume = document.querySelector(
          'option[data-i18n="option.volume.placeholder"]'
        );
        if (optVolume && dict["option.volume.placeholder"]) {
          optVolume.textContent = dict["option.volume.placeholder"];
        }

        const optCash = document.querySelector(
          'option[data-i18n="option.cash.placeholder"]'
        );
        if (optCash && dict["option.cash.placeholder"]) {
          optCash.textContent = dict["option.cash.placeholder"];
        }
      }

      // idioma inicial
      applyTranslations(currentLang);

      // toggle idioma
      document.querySelectorAll(".lang-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const lang = btn.getAttribute("data-lang");
          currentLang = lang;
          document
            .querySelectorAll(".lang-btn")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          applyTranslations(lang);
        });
      });

      // Mostrar / ocultar "Otro" país e industria
      const countrySelect = document.getElementById("country");
      const countryOther = document.getElementById("countryOther");
      countrySelect.addEventListener("change", () => {
        countryOther.style.display =
          countrySelect.value === "OTHER" ? "block" : "none";
        if (countrySelect.value !== "OTHER") countryOther.value = "";
      });

      const industrySelect = document.getElementById("industry");
      const industryOther = document.getElementById("industryOther");
      industrySelect.addEventListener("change", () => {
        industryOther.style.display =
          industrySelect.value === "other" ? "block" : "none";
        if (industrySelect.value !== "other") industryOther.value = "";
      });

      // UBOs dinámicos
      const uboList = document.getElementById("ubo-list");
      const btnAddUbo = document.getElementById("btn-add-ubo");
      let uboCounter = 0;

      function createUboItem() {
        uboCounter++;
        const dict = translations[currentLang];

        const wrapper = document.createElement("div");
        wrapper.className = "ubo-item";

        const header = document.createElement("div");
        header.className = "ubo-header";

        const title = document.createElement("div");
        title.className = "ubo-title";
        title.textContent = (dict && dict["ubo.title"]) || "UBO";

        const removeBtn = document.createElement("button");
        removeBtn.type = "button";
        removeBtn.className = "ubo-remove";
        removeBtn.textContent = "✕";
        removeBtn.addEventListener("click", () => {
          uboList.removeChild(wrapper);
        });

        header.appendChild(title);
        header.appendChild(removeBtn);

        const grid = document.createElement("div");
        grid.className = "ubo-grid";

        function makeGroup(labelKey, inputIdSuffix) {
          const group = document.createElement("div");
          group.className = "form-group";

          const label = document.createElement("label");
          label.className = "form-label";
          label.textContent =
            (dict && dict[labelKey]) || labelKey || "Campo";

          const input = document.createElement("input");
          input.id = `ubo_${uboCounter}_${inputIdSuffix}`;

          group.appendChild(label);
          group.appendChild(input);
          return group;
        }

        const g1 = makeGroup("label.uboName", "name");
        const g2 = makeGroup("label.uboNationality", "nationality");
        const g3 = makeGroup("label.uboOwnership", "ownership");
        const g4 = makeGroup("label.uboId", "id");
        const g5 = makeGroup("label.uboResidence", "residence");

        const g6 = document.createElement("div");
        g6.className = "form-group";
        const l6 = document.createElement("label");
        l6.className = "form-label";
        l6.textContent =
          (dict && dict["label.uboPep"]) || "¿Es PEP?";
        const s6 = document.createElement("select");
        s6.id = `ubo_${uboCounter}_pep`;
        const optPlaceholder = document.createElement("option");
        optPlaceholder.value = "";
        optPlaceholder.disabled = true;
        optPlaceholder.selected = true;
        optPlaceholder.textContent =
          (dict && dict["option.pep.placeholder"]) ||
          "Selecciona una opción";
        const optNo = document.createElement("option");
        optNo.value = "no";
        optNo.textContent = (dict && dict["option.no"]) || "No";
        const optYes = document.createElement("option");
        optYes.value = "yes";
        optYes.textContent = (dict && dict["option.yes"]) || "Sí";
        s6.appendChild(optPlaceholder);
        s6.appendChild(optNo);
        s6.appendChild(optYes);
        g6.appendChild(l6);
        g6.appendChild(s6);

        grid.appendChild(g1);
        grid.appendChild(g2);
        grid.appendChild(g3);
        grid.appendChild(g4);
        grid.appendChild(g5);
        grid.appendChild(g6);

        wrapper.appendChild(header);
        wrapper.appendChild(grid);
        return wrapper;
      }

      // Agregar un UBO inicial
      uboList.appendChild(createUboItem());

      btnAddUbo.addEventListener("click", () => {
        uboList.appendChild(createUboItem());
      });

      // Envío a Airtable + subida de documentos a Vercel Blob

      const form = document.getElementById("onboarding-form");
      const statusMsg = document.getElementById("status-msg");
      const submitBtn = document.getElementById("submit-btn");

      // Inputs de documentos
      const docCertInput = document.getElementById("docCert");
      const docRepInput = document.getElementById("docRep");
      const docUbosInput = document.getElementById("docUbos");
      const docStructureInput = document.getElementById("docStructure");

      // Helpers para subir archivos a /api/upload (Vercel Blob)
      async function uploadSingleFile(file) {
        const res = await fetch(
          `/api/upload?filename=${encodeURIComponent(file.name)}`,
          {
            method: "POST",
            body: file,
          }
        );

        if (!res.ok) {
          throw new Error("Error subiendo archivo: " + file.name);
        }

        const data = await res.json();
        return data.url; // URL pública en Vercel Blob
      }

      async function uploadMultipleFiles(files) {
        const urls = [];
        for (const file of files) {
          const url = await uploadSingleFile(file);
          urls.push(url);
        }
        return urls;
      }

      async function uploadAllDocuments() {
        const result = {
          docCertUrl: null,
          docRepUrl: null,
          docUbosUrls: [],
          docStructureUrl: null,
        };

        if (docCertInput.files && docCertInput.files[0]) {
          result.docCertUrl = await uploadSingleFile(docCertInput.files[0]);
        }

        if (docRepInput.files && docRepInput.files[0]) {
          result.docRepUrl = await uploadSingleFile(docRepInput.files[0]);
        }

        if (docUbosInput.files && docUbosInput.files.length > 0) {
          result.docUbosUrls = await uploadMultipleFiles(
            Array.from(docUbosInput.files)
          );
        }

        if (docStructureInput.files && docStructureInput.files[0]) {
          result.docStructureUrl = await uploadSingleFile(
            docStructureInput.files[0]
          );
        }

        return result;
      }

      // Endpoint interno que reenvía a Airtable (api/airtable-proxy.js)
      const AIRTABLE_WEBHOOK_URL = "/api/airtable-proxy";

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        statusMsg.textContent = "";
        statusMsg.className = "status-msg";

        if (!form.checkValidity()) {
          const dict = translations[currentLang];
          statusMsg.textContent =
            (dict && dict.statusRequired) ||
            "Por favor completa los campos obligatorios marcados con *.";
          statusMsg.classList.add("error");
          return;
        }

        submitBtn.disabled = true;

        // 1) Subir documentos a Blob y obtener URLs
        let documents = null;
        try {
          documents = await uploadAllDocuments();
        } catch (uploadErr) {
          console.error(uploadErr);
          statusMsg.textContent =
            currentLang === "es"
              ? "Hubo un error al subir los documentos. Intenta de nuevo."
              : "There was an error uploading the documents. Please try again.";
          statusMsg.classList.add("error");
          submitBtn.disabled = false;
          return;
        }

        // 2) Construir payload con datos + URLs de documentos
        const payload = {
          language: currentLang,
          businessName: document.getElementById("businessName").value,
          tradeName: document.getElementById("tradeName").value,
          country: document.getElementById("country").value,
          countryOther: document.getElementById("countryOther").value,
          regNumber: document.getElementById("regNumber").value,
          address: document.getElementById("address").value,
          website: document.getElementById("website").value,

          industry: document.getElementById("industry").value,
          industryOther: document.getElementById("industryOther").value,
          customerType: document.getElementById("customerType").value,
          salesChannels: document.getElementById("salesChannels").value,
          customerCountries: document.getElementById("customerCountries").value,
          businessModel: document.getElementById("businessModel").value,

          repName: document.getElementById("repName").value,
          repRole: document.getElementById("repRole").value,
          repId: document.getElementById("repId").value,
          repNationality: document.getElementById("repNationality").value,
          repEmail: document.getElementById("repEmail").value,
          repPhone: document.getElementById("repPhone").value,
          repPep: document.getElementById("repPep").value,

          monthlyVolume: document.getElementById("monthlyVolume").value,
          currencies: document.getElementById("currencies").value,
          inboundCountries:
            document.getElementById("inboundCountries").value,
          outboundCountries:
            document.getElementById("outboundCountries").value,
          cashUsage: document.getElementById("cashUsage").value,

          decTruth: document.getElementById("decTruth").checked,
          decData: document.getElementById("decData").checked,
          decIllicit: document.getElementById("decIllicit").checked,
          decSanctions: document.getElementById("decSanctions").checked,

          submittedAt: new Date().toISOString(),
          documents, // objeto con las URLs de Blob
        };

        try {
          const resp = await fetch(AIRTABLE_WEBHOOK_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          if (!resp.ok) {
            throw new Error("Airtable devolvió estado " + resp.status);
          }

          const dict = translations[currentLang];
          statusMsg.textContent =
            (dict && dict.statusSuccess) ||
            "Datos enviados correctamente.";
          statusMsg.classList.add("success");
          form.reset();
          docCertInput.value = "";
          docRepInput.value = "";
          docUbosInput.value = "";
          docStructureInput.value = "";
        } catch (err) {
          console.error(err);
          statusMsg.textContent =
            currentLang === "es"
              ? "Hubo un error al enviar los datos. Intenta de nuevo."
              : "There was an error sending data. Please try again.";
          statusMsg.classList.add("error");
        } finally {
          submitBtn.disabled = false;
        }
      });
    </script>
